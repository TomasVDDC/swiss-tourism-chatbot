<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FastAPI HTML File</title>
    <link href="static/css/output.css" rel="stylesheet">
    <!-- htmx -->
    <script src="static/lib/htmx.js" integrity="sha384-Y7hw+L/jvKeWIRRkqWYfPcvVxHzVzn5REgzbawhxAuQGwX1XWe70vji+VSeHOThJ"
	    crossorigin="anonymous"></script>
    <!-- open layers -->
    <script src="https://cdn.jsdelivr.net/npm/ol@v10.1.0/dist/ol.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v10.1.0/ol.css">
    

</head>
<body>
  
  <div id="map" class = " w-full h-[634px] right-0 fixed bottom-[calc(4rem+1.5rem)]" ></div>
  
  <div style="box-shadow: 0 0 #0000, 0 0 #0000, 0 1px 2px 0 rgb(0 0 0 / 0.05);"
    class="  fixed bottom-[calc(4rem+1.5rem)] left-0 mr-4 bg-white p-6 rounded-lg border border-[#e5e7eb] w-[440px] h-[634px]  ">


    <!-- Chat Container -->
    <div id="chat-container" class="pr-4 h-[520px] overflow-y-auto w-full"  >
      <!-- Chat Message AI -->
      <div class="flex gap-3 my-4 text-gray-600 text-sm flex-1"><span
          class="relative flex shrink-0 overflow-hidden rounded-full w-8 h-8">
          <div class="rounded-full bg-gray-100 border p-1"><svg stroke="none" fill="black" stroke-width="1.5"
              viewBox="0 0 24 24" aria-hidden="true" height="20" width="20" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z">
              </path>
            </svg></div>
        </span>
        <p class="leading-relaxed"><span class="block font-bold text-gray-700">AI </span>Hi, how can I help you today?
        </p>
      </div>

    </div>
    <!-- Input box  -->
    <div class="flex items-center pt-0">
      <form  hx-get="/chatprompt" hx-on::after-request=" if(event.detail.successful) this.reset()" hx-swap="beforeend  scroll:bottom" hx-target="#chat-container"
	class="flex items-center justify-center w-full space-x-2">
        <input
          class="flex h-10 w-full rounded-md border border-[#e5e7eb] px-3 py-2 text-sm placeholder-[#6b7280] focus:outline-none focus:ring-2 focus:ring-[#9ca3af] disabled:cursor-not-allowed disabled:opacity-50 text-[#030712] focus-visible:ring-offset-2"
          placeholder="Type your message" name="user_prompt">
        <button
          class="inline-flex items-center justify-center rounded-md text-sm font-medium text-[#f9fafb] disabled:pointer-events-none disabled:opacity-50 bg-black hover:bg-[#111827E6] h-10 px-4 py-2">
          Send</button>
      </form>
    </div>

  </div>
  
  <script>
    let places_array = [];
    const vectorLayer = new ol.layer.Vector({
        source: new ol.source.Vector(),

    });
    // let map;
    
    initializeMap()

    document.addEventListener("map", async () => {
	try {
	    const response = await fetch('/get_places'); // Fetch data from the 'get_places' route
	    if (!response.ok) {
		throw new Error(`HTTP error! status: ${response.status}`);
	    }

	    places_array = await response.json(); // Parse the JSON response
	    updateMapFeatures()
	    
	} catch (error) {
	    console.error("Error fetching places:", error);
	}
    });

  function initializeMap() {
    


	// let numberOfPlaces = Array.isArray(places_array) ? places_array.length : 0;
	// console.log("numberOfPlaces",numberOfPlaces)
	
	// for (i = 0; i < numberOfPlaces; i++) {

        //     coor = [places_array[i].longitude, places_array[i].latitude ]
	//     console.log("coor",coor)
        //     // description = {{.}}[i].Description
        //     // url = {{.}}[i].Url

        //     const feature = new ol.Feature({
	// 	geometry: new ol.geom.Point(
        //             ol.proj.fromLonLat(coor))
	// 	// description: description,
	// 	// url: url

        //     });
        //     vectorLayer.getSource().addFeature(feature)
	// }


	// coor = [8.035754930988903,46.82094325036989]  //longitude,latitude
	
	// const feature = new ol.Feature({
	//     geometry: new ol.geom.Point(
	//         ol.proj.fromLonLat(coor))
	// });

	// vectorLayer.getSource().addFeature(feature)

	var imageStyle = new ol.style.Style({
            image: new ol.style.Circle({
		radius: 8,
		fill: new ol.style.Fill({ color: 'red' }),
		stroke: new ol.style.Stroke({ color: 'black', width: 2 })
            })
	});


	vectorLayer.setStyle(imageStyle);


	const map = new ol.Map({
	    target: 'map',
	    view: new ol.View({
		center: [831634.867743, 5903537.442577], // Coordinate system is EPSG:3857
		zoom: 8,

	    }),
	    layers: [new ol.layer.Tile({
		source: new ol.source.OSM()
	    }), vectorLayer]
	});
    }

    function updateMapFeatures() {
        // Clear existing features before adding new ones
        // vectorLayer.getSource().clear();

        let numberOfPlaces = Array.isArray(places_array) ? places_array.length : 0;
        console.log("numberOfPlaces", numberOfPlaces);

        for (let i = 0; i < numberOfPlaces; i++) {
	    const coor = [places_array[i].longitude, places_array[i].latitude];
	    console.log("coor", coor);
	    // description = {{.}}[i].Description
	    // url = {{.}}[i].Url

	    const feature = new ol.Feature({
                geometry: new ol.geom.Point(
		    ol.proj.fromLonLat(coor))
                // description: description,
                // url: url
	    });
	    vectorLayer.getSource().addFeature(feature);
        }
    }
    
  </script>  

</body>


</html>
